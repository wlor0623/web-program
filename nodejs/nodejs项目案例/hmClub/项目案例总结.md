## 项目开发流程的确定

* 1.需求分析阶段
    * (1):文章模块
        * 添加文章
        * 查看文章
        * 编辑文章
    * (2)用户
        * 注册
        * 登陆
        * 免登陆（登陆之后下一次进入网站自动登陆）

* 2.需求设计阶段

* 服务端项目架构
    * app.js:服务器的入口
        * 职责：负责获取客户端的请求
    * router：路由
        * 职责：将app.js获取的网络请求分发给不同的控制器
    * controller：C层：负责处理业务逻辑
        * 职责：（1）处理业务逻辑，将处理的结果响应给客户端    （2）负责将model的数据渲染到View上（服务端渲染）
    * View：V层，htm模板
        * 职责：负责显示model数据
    * Model：M层，数据
        * 职责：负责显示到view中
    * 数据库：mongodb
        * 职责：负责数据的增删改查

* 3.编码

* 4.测试阶段


## 项目编码阶段

* 1.确定项目的目录结构
    * app.js:服务端入口
    * router文件夹
        * article_router.js:负责文章相关请求的路由分发
        * user_router.js:负责用户相关请求的路由分发
        * index_router.js:负责首页的相关请求的路由分发
            * 客户端入口
    * controller文件夹
        * article_controller.js:负责处理文章相关功能的业务逻辑
        * user_controller.js:负责处理用户相关功能的业务逻辑
        * index_controller.js:负责首页的相关业务逻辑
    * views文件夹
        * articleView：文章相关html模板
        * login.html
        * register.html
        * index.html
    * modeld文件夹
        * article_model:负责维护文章模块所需要的数据（增删改查）
        * user_modeld:负责维护用户的数据
        * index_model:本身提供任何数据，只负责将user和article的数据显示在一起
            * 首页模型的职责：其他模块数据的沟通桥梁
            * mongoose的初始化操作由它来完成
    * public:开放的静态资源
        * css：样式
        * images：图片
    * node_modules:第三方模块
    * 配置文件
        * errHandler.js:属于配置文件，作用将服务端所有的错误编码放入到一个文件，方便维护

2.搭建数据库结构（Schema）
    * 文章articel
        * title：标题
        * article_type:文章类型
            * wenda：问答
            * wenzhang：文章
            * chuishui：吹水
        * content：内容
        * visits：查看数（阅读数量）
        * 文章的添加时间和修改时间由mongoose自动维护
            * updateAt：修改时间  createAt：创建时间
    * 用户user
        * email:邮箱
        * password:密码
        * nickname：昵称
        * avatar：用户头像
        * 用户的添加时间和修改时间由mongoose自动维护
            * updateAt：修改时间  createAt：创建时间
    * 首页index

3.搭建服务器平台（入口文件）
    * 1.创建服务器
    * 2.托管静态资源
        * express.static():唯一内置的中间件
    * 3.配置模板引擎
        * 中间件
    * 4.中间件：我们的原生express达不到要求，所以借助一些第三方中间件来帮我们快速开发
        * 第三方中间件的共同特点：给req或者res添加一些属性和方法
            * 所有的中间件都是对req和res的一个拓展（加属性和方法），因为服务端开发六个字：请求处理响应
    * 5.路由：app.use(路由容器)
    * 6.监听端口号

* 4.显示首页
    * 服务端渲染res.render()

* 5.添加文章
    * （1）客户端post提交表单数据
    * （2）服务端接收数据
    * （3）服务端保存到数据库
    * （4）服务端响应返回添加结果

* 6.查看文章
    * 客户端
        * 点击文章title，发起get请求，参数是文章的id
            * id是mongoose自动为我们数据库添加的唯一标识符
    * 服务端
        * 1.获取get请求的参数文章id
        * 2.通过文章id查看数据库
        * 3.文章查看数+1
        * 4.修改数据库
        * 5.渲染返回查看文章模板

* 7.显示编辑界面
    * 客户端
        * 点击编辑按钮，发起get请求，参数是文章的id
    * 服务端
        * 1.获取get请求的参数文章
        * 2.查询数据库
        * 3.响应返回渲染的编辑文章模板

* 8.完成编辑功能
    * 客户端
        * 表单post提交文章数据
    * 服务端
        * 1.获取post参数数据
        * 2.更新到数据库
        * 3.响应返回操作（更新）结果

* 9.注册功能
    * 1.用户点击注册按钮进入注册界面
    * 2.提交注册
        * 客户端
            * 客户但提交post表单数据
        * 服务端
            * （1）获取post请求数据
            * （2）查询数据库 根据邮箱
                * 如果该邮箱已经在数据库，则返回邮箱已存在
                * 如果该邮箱不再数据库，则进行下一步
            * （3）将post请求的数据添加到数据库
            * （4）响应返回处理结果

* 10.登陆功能
    * 客户端
        * 提交登陆表单数据
    * 服务端
        * （1）获取post请求数据
        * （2）先查询邮箱是否存在
            * 如果邮箱不存在，直接响应返回用户名或者密码错误
            * 如果邮箱存在，下一步
        * （3）查询密码是否与该邮箱一致
            * 如果密码与邮箱不匹配，直接响应返回用户名或者密码错误
            * 如果匹配则返回登陆成功

* 11.使用cookie保持用户登陆状态
    * cookie本质是一个键值对
    * cookie的作用是保持用户状态
    * （1）登陆时写入cookie，将用户信息写入cookie
    * (2)注销时，销毁cookie （req.session = null）
    * (3)一旦登陆，所有的请求都可以获取cookie，一旦注销所有的请求都拿不到cookie

* 12：注销清除用户cookie完整流程
    * 1.加载首页时候，将获取到的cookie传入模板 res.render('index.html',{
        article:docs,
        user:req.session.user
    })
    * 2.index.html模板中根据user的值是否存在来判断用户是否登陆
        * 如果未登陆则头部导航显示注册登陆按钮
        * 如果用户登陆则头部导航显示用户信息及注销按钮
    * 3.当用户点击注销按钮时
        * （1）清除当前用户的cookie：req.session.user = null
        * (2)调用indexcontroller的加载首页的函数方法（重新渲染首页）indexcontroller.showIndex(req,res)

* 13.完善文章编辑功能

* 1.如果一个文章可以被编辑，需要哪些条件
    * （1）用户必须是登陆 （2）这篇文章一定是当前登陆的这个用户编写
        * 第一个问题：通过cookie可以解决
        * 第二个问题解决方案：给文章模型添加一个字段 user_id,该字段的值是添加文章的用户的id
            * { 额外添加一个字段 user_id:哪一个用户添加的文章
                _id: 5a1a7baee6d9c82d10563013,
                updatedAt: 2017-11-26T08:30:38.823Z,
                createdAt: 2017-11-26T08:30:38.823Z,
                 title: '老铁',
                content: '风格的年份的功能的',
                __v: 0,
                visits: 0,
                articleType: 'wenda' }

* 2。在添加文章时，怎么知道用户的id
    * （1）使用模板引擎传值
    * （2）如果用户没有登陆，是不可以添加文章的，要想添加文章用户一定是登陆状态

* 3.当用户点击添加文章按钮时，将用户的id传值到添加文章模板中articleAdd.html

* 4.用户查看文章时，将用户的cookie传入到文章详情articleInfo.html模板中
    * 传值的作用：逻辑判断
        * 如果用户user存在，且用户user的id与当前文章的id一致则显示编辑按钮，否则不显示